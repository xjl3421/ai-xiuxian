# 新增功能说明

本次更新为修仙放置游戏增加了以下功能：

## 1. 消息通知堆叠功能 ✅
- **第一条消息**: 完整展示标题和内容
- **其他消息**: 自动堆叠，仅显示标题和简略内容
- **删除按钮**: 每条消息右上角都有 X 按钮，可以手动删除通知
- **悬停展开**: 鼠标悬停在堆叠的消息上会展开显示更多信息

## 2. 门派功能 ✅
- **奇遇加入**: 在"门派招新"奇遇中可以选择加入门派
- **突破加入**: 达到大境界(筑基、金丹、元婴、化神、大乘、渡劫、飞升)时,如果没有门派，会自动弹出门派选择对话框
- **门派列表**: 
  - 青云门 (正道第一大派，修炼剑道)
  - 天音寺 (佛门圣地，修炼佛法)
  - 鬼王宗 (魔道势力,修炼鬼道)
  - 合欢派 (魔道势力，双修之道)
  - 焚香谷 (正道门派，修炼火道)
  - 散修联盟 (散修聚集地，自由自在)
- **选择自由**: 可以选择加入门派，也可以选择继续散修

## 3. 年龄与寿命系统 ✅
- **年龄增长**: 每次战斗后年龄增加1岁
- **寿命增加**: 突破大境界时寿命会大幅增加
  - 筑基: +100年
  - 金丹: +200年
  - 元婴: +300年
  - 化神: +500年
  - 大乘: +800年
  - 渡劫: +1000年
  - 飞升: +5000年
- **生涯结束**: 达到寿命极限而未能突破境界时，游戏结束
- **修仙总结**: 游戏结束时会显示详细的修仙生涯总结
  - 道号、门派、职业、体质
  - 最终境界、等级
  - 寿命、属性
  - 灵兽、资源等信息

## 4. 导出/导入功能 ✅
- **导出经历**: 点击顶部导出按钮(下载图标)，可将当前修仙经历导出为JSON文件
  - 文件名格式: `修仙经历_角色名_境界_Lv等级_日期.json`
  - 包含所有游戏数据：玩家信息、资源、装备、任务、自动挂机状态等
- **导入经历**: 点击顶部导入按钮(上传图标)，可导入之前导出的JSON文件
  - 自动恢复所有游戏进度
  - 导入后立即进入游戏
- **游戏结束导出**: 在游戏结束弹窗中也可以导出修仙经历作为纪念

## 技术实现要点

### 1. 通知系统
- 使用index判断是否为第一条
- CSS transition实现动画效果
- truncate类实现文本截断

### 2. 门派系统
- 新增SECTS常量数组
- MAJOR_REALMS定义大境界
- showSectDialog状态控制门派选择弹窗
- joinSect函数处理加入门派逻辑

### 3. 年龄寿命系统
- REALM_LIFESPAN_BONUS定义各境界寿命加成
- endBattle中增加年龄并检查游戏结束
- checkGameOver函数检查是否达到寿命极限
- showGameOverDialog显示游戏结束弹窗
- gameOverSummary存储修仙总结

### 4. 导出导入系统
- exportGame使用Blob和URL.createObjectURL生成下载
- importGame使用FileReader读取JSON文件
- 包含exportDate时间戳
- 所有游戏状态数据完整保存和恢复

## 文件变更
- `/src/app/page.tsx` - 主游戏组件,包含所有新功能
